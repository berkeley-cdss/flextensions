<%= render "layouts/sidebar" %>
<div class="container mt-4" data-controller="extension-form">
	<div class="row justify-content-center">
		<div class="col-12">
			<%= render "courses/course_title" %>

			<%= form_with(model: [@course, @request], method: :post, local: true) do |f| %>
			<% if @request.errors.any? %>
				<div id="error_explanation" class="alert alert-danger">
					<h2><%= pluralize(@request.errors.count, "error") %> prohibited this request from being saved:</h2>
					<ul>
						<% @request.errors.full_messages.each do |msg| %>
							<li><%= msg %></li>
						<% end %>
					</ul>
				</div>
			<% end %>

			<div class="mb-3">
				<%= f.label :assignment_id, "Assignment", class: "form-label fw-bold", for: "new-request-assignment-id" %>
				<%= f.select :assignment_id,
				options_for_select(
					@assignments.map do |assignment|
					[
						"#{assignment.name}",
						assignment.id,
						{
						"data-original-due-date" => assignment.due_date.strftime('%Y-%m-%d at %I:%M %p'),
						"data-original-late-due-date" => assignment.late_due_date.strftime('%Y-%m-%d at %I:%M %p')
						}
					]
					end,
					params[:assignment_id].to_i
				),
				{ prompt: '---', required: true },
				{
					class: "form-select",
					id: "new-request-assignment-id",
					data: {
					extension_form_target: "assignmentSelect",
					action: "change->extension-form#updateAssignment"
					}
				}
				%>
			</div>

			<div class="col-12 col-lg-5 mb-3">
				<p>Due Date: <strong id="due-date"><%= @selected_assignment.due_date.strftime('%Y-%m-%d at %I:%M %p') if @selected_assignment %></strong></p>
			</div>
			<div class="col-12 col-lg-5 mb-3">
				<p>Late Due Date: <strong id="late-due-date"><%= @selected_assignment.late_due_date.strftime('%Y-%m-%d at %I:%M %p') if @selected_assignment %></strong></p>
			</div>

			<div class="row justify-content-between align-items-center p-0">
				<div class="col-5 mb-3">
					<%= f.label :requested_due_date, "Requested Due Date", class: "form-label fw-bold", for: "new-request-requested-due-date" %>
					<%= f.date_field :requested_due_date,
						class: "form-control",
						id: "new-request-requested-due-date",
						value: (@selected_assignment.due_date.strftime('%Y-%m-%d') if @selected_assignment),
						required: true,
						data: { 
							extension_form_target: "dueDateInput",
							"original-due-date" => (@selected_assignment.due_date.strftime('%Y-%m-%d') if @selected_assignment),
							action: "input->extension-form#updateDays"
						} %>
				</div>

				<div class="col-12 col-lg-5 mb-3">
					<p class="mb-0">Number of Days: <strong id="days" data-extension-form-target="daysDisplay">#</strong></p>
				</div>
			</div>

			<div class="mb-3">
				<%= f.label :reason, "Why do you need this extension?", class: "form-label fw-bold" %>
				<% if @form_settings.reason_desc.presence %>
					<p><%= @form_settings.reason_desc %></p>
				<% end %>
				<%= f.text_area :reason, class: "form-control", id: "reason", rows: 2, required: true %>
			</div>

			<div class="mb-3">
				<%= f.label :additional_doc, "Additional Documentation", class: "form-label fw-bold" %>
				
				<% if @form_settings.documentation_desc.presence %>
					<p><%= @form_settings.documentation_desc %></p>
				<% end %>
				<%= f.text_area :additional_doc, class: "form-control", id: "additional-doc", rows: 2, required: true %>
			</div>

			<div class="mb-3">
				<%= f.label :custom_question_1, "Custom Question 1", class: "form-label fw-bold" %>
				<p>Custom Question 1 Description</p>
				<%= f.text_area :custom_question_1, class: "form-control", id: "custom-question-1", rows: 2, required: true %>
			</div>

			<div class="mb-3">
				<%= f.label :custom_question_2, "Custom Question 2", class: "form-label fw-bold" %>
				<p>Custom Question 2 Description</p>
				<%= f.text_area :custom_question_2, class: "form-control", id: "custom-question-2", rows: 2, required: true %>
			</div>

			<div class="text-center">
				<%= f.submit "Submit", class: "btn btn-secondary" %>
			</div>
			<% end %>
		</div>
	</div>
</div>